{"ast":null,"code":"/*\n * Copyright 2012-2016 the original author or authors\n * @license MIT, see LICENSE.txt for details\n *\n * @author Scott Andrews\n */\n'use strict';\n\nvar interceptor, mime, registry, noopConverter, missingConverter, attempt;\ninterceptor = require('../interceptor');\nmime = require('../mime');\nregistry = require('../mime/registry');\nattempt = require('../util/attempt');\nnoopConverter = {\n  read: function read(obj) {\n    return obj;\n  },\n  write: function write(obj) {\n    return obj;\n  }\n};\nmissingConverter = {\n  read: function read() {\n    throw 'No read method found on converter';\n  },\n  write: function write() {\n    throw 'No write method found on converter';\n  }\n};\n/**\n * MIME type support for request and response entities.  Entities are\n * (de)serialized using the converter for the MIME type.\n *\n * Request entities are converted using the desired converter and the\n * 'Accept' request header prefers this MIME.\n *\n * Response entities are converted based on the Content-Type response header.\n *\n * @param {Client} [client] client to wrap\n * @param {string} [config.mime='text/plain'] MIME type to encode the request\n *   entity\n * @param {string} [config.accept] Accept header for the request\n * @param {Client} [config.client=<request.originator>] client passed to the\n *   converter, defaults to the client originating the request\n * @param {Registry} [config.registry] MIME registry, defaults to the root\n *   registry\n * @param {boolean} [config.permissive] Allow an unkown request MIME type\n *\n * @returns {Client}\n */\n\nmodule.exports = interceptor({\n  init: function init(config) {\n    config.registry = config.registry || registry;\n    return config;\n  },\n  request: function request(_request, config) {\n    var type, headers;\n    headers = _request.headers || (_request.headers = {});\n    type = mime.parse(headers['Content-Type'] || config.mime || 'text/plain');\n    headers.Accept = headers.Accept || config.accept || type.raw + ', application/json;q=0.8, text/plain;q=0.5, */*;q=0.2';\n\n    if (!('entity' in _request)) {\n      return _request;\n    }\n\n    headers['Content-Type'] = type.raw;\n    return config.registry.lookup(type)['catch'](function () {\n      // failed to resolve converter\n      if (config.permissive) {\n        return noopConverter;\n      }\n\n      throw 'mime-unknown';\n    }).then(function (converter) {\n      var client = config.client || _request.originator,\n          write = converter.write || missingConverter.write;\n      return attempt(write.bind(void 0, _request.entity, {\n        client: client,\n        request: _request,\n        mime: type,\n        registry: config.registry\n      }))['catch'](function () {\n        throw 'mime-serialization';\n      }).then(function (entity) {\n        _request.entity = entity;\n        return _request;\n      });\n    });\n  },\n  response: function response(_response, config) {\n    if (!(_response.headers && _response.headers['Content-Type'] && _response.entity)) {\n      return _response;\n    }\n\n    var type = mime.parse(_response.headers['Content-Type']);\n    return config.registry.lookup(type)['catch'](function () {\n      return noopConverter;\n    }).then(function (converter) {\n      var client = config.client || _response.request && _response.request.originator,\n          read = converter.read || missingConverter.read;\n      return attempt(read.bind(void 0, _response.entity, {\n        client: client,\n        response: _response,\n        mime: type,\n        registry: config.registry\n      }))['catch'](function (e) {\n        _response.error = 'mime-deserialization';\n        _response.cause = e;\n        throw _response;\n      }).then(function (entity) {\n        _response.entity = entity;\n        return _response;\n      });\n    });\n  }\n});","map":{"version":3,"names":["interceptor","mime","registry","noopConverter","missingConverter","attempt","require","read","obj","write","module","exports","init","config","request","type","headers","parse","Accept","accept","raw","lookup","permissive","then","converter","client","originator","bind","entity","response","e","error","cause"],"sources":["D:/Chronicle/chronicle-ttm/src/main/frontend/node_modules/rest/interceptor/mime.js"],"sourcesContent":["/*\n * Copyright 2012-2016 the original author or authors\n * @license MIT, see LICENSE.txt for details\n *\n * @author Scott Andrews\n */\n\n'use strict';\n\nvar interceptor, mime, registry, noopConverter, missingConverter, attempt;\n\ninterceptor = require('../interceptor');\nmime = require('../mime');\nregistry = require('../mime/registry');\nattempt = require('../util/attempt');\n\nnoopConverter = {\n\tread: function (obj) { return obj; },\n\twrite: function (obj) { return obj; }\n};\n\nmissingConverter = {\n\tread: function () { throw 'No read method found on converter'; },\n\twrite: function () { throw 'No write method found on converter'; }\n};\n\n/**\n * MIME type support for request and response entities.  Entities are\n * (de)serialized using the converter for the MIME type.\n *\n * Request entities are converted using the desired converter and the\n * 'Accept' request header prefers this MIME.\n *\n * Response entities are converted based on the Content-Type response header.\n *\n * @param {Client} [client] client to wrap\n * @param {string} [config.mime='text/plain'] MIME type to encode the request\n *   entity\n * @param {string} [config.accept] Accept header for the request\n * @param {Client} [config.client=<request.originator>] client passed to the\n *   converter, defaults to the client originating the request\n * @param {Registry} [config.registry] MIME registry, defaults to the root\n *   registry\n * @param {boolean} [config.permissive] Allow an unkown request MIME type\n *\n * @returns {Client}\n */\nmodule.exports = interceptor({\n\tinit: function (config) {\n\t\tconfig.registry = config.registry || registry;\n\t\treturn config;\n\t},\n\trequest: function (request, config) {\n\t\tvar type, headers;\n\n\t\theaders = request.headers || (request.headers = {});\n\t\ttype = mime.parse(headers['Content-Type'] || config.mime || 'text/plain');\n\t\theaders.Accept = headers.Accept || config.accept || type.raw + ', application/json;q=0.8, text/plain;q=0.5, */*;q=0.2';\n\n\t\tif (!('entity' in request)) {\n\t\t\treturn request;\n\t\t}\n\n\t\theaders['Content-Type'] = type.raw;\n\n\t\treturn config.registry.lookup(type)['catch'](function () {\n\t\t\t// failed to resolve converter\n\t\t\tif (config.permissive) {\n\t\t\t\treturn noopConverter;\n\t\t\t}\n\t\t\tthrow 'mime-unknown';\n\t\t}).then(function (converter) {\n\t\t\tvar client = config.client || request.originator,\n\t\t\t\twrite = converter.write || missingConverter.write;\n\n\t\t\treturn attempt(write.bind(void 0, request.entity, { client: client, request: request, mime: type, registry: config.registry }))\n\t\t\t\t['catch'](function() {\n\t\t\t\t\tthrow 'mime-serialization';\n\t\t\t\t})\n\t\t\t\t.then(function(entity) {\n\t\t\t\t\trequest.entity = entity;\n\t\t\t\t\treturn request;\n\t\t\t\t});\n\t\t});\n\t},\n\tresponse: function (response, config) {\n\t\tif (!(response.headers && response.headers['Content-Type'] && response.entity)) {\n\t\t\treturn response;\n\t\t}\n\n\t\tvar type = mime.parse(response.headers['Content-Type']);\n\n\t\treturn config.registry.lookup(type)['catch'](function () { return noopConverter; }).then(function (converter) {\n\t\t\tvar client = config.client || response.request && response.request.originator,\n\t\t\t\tread = converter.read || missingConverter.read;\n\n\t\t\treturn attempt(read.bind(void 0, response.entity, { client: client, response: response, mime: type, registry: config.registry }))\n\t\t\t\t['catch'](function (e) {\n\t\t\t\t\tresponse.error = 'mime-deserialization';\n\t\t\t\t\tresponse.cause = e;\n\t\t\t\t\tthrow response;\n\t\t\t\t})\n\t\t\t\t.then(function (entity) {\n\t\t\t\t\tresponse.entity = entity;\n\t\t\t\t\treturn response;\n\t\t\t\t});\n\t\t});\n\t}\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}