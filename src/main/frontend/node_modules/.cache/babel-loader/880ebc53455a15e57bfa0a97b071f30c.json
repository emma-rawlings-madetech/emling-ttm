{"ast":null,"code":"/*\n * Copyright 2012-2014 the original author or authors\n * @license MIT, see LICENSE.txt for details\n *\n * @author Scott Andrews\n */\n(function (define, global) {\n  'use strict';\n\n  define(function (require) {\n    var when, UrlBuilder, normalizeHeaderName, responsePromise, client, headerSplitRE;\n    when = require('when');\n    UrlBuilder = require('../UrlBuilder');\n    normalizeHeaderName = require('../util/normalizeHeaderName');\n    responsePromise = require('../util/responsePromise');\n    client = require('../client'); // according to the spec, the line break is '\\r\\n', but doesn't hold true in practice\n\n    headerSplitRE = /[\\r|\\n]+/;\n\n    function parseHeaders(raw) {\n      // Note: Set-Cookie will be removed by the browser\n      var headers = {};\n\n      if (!raw) {\n        return headers;\n      }\n\n      raw.trim().split(headerSplitRE).forEach(function (header) {\n        var boundary, name, value;\n        boundary = header.indexOf(':');\n        name = normalizeHeaderName(header.substring(0, boundary).trim());\n        value = header.substring(boundary + 1).trim();\n\n        if (headers[name]) {\n          if (Array.isArray(headers[name])) {\n            // add to an existing array\n            headers[name].push(value);\n          } else {\n            // convert single value to array\n            headers[name] = [headers[name], value];\n          }\n        } else {\n          // new, single value\n          headers[name] = value;\n        }\n      });\n      return headers;\n    }\n\n    function safeMixin(target, source) {\n      Object.keys(source || {}).forEach(function (prop) {\n        // make sure the property already exists as\n        // IE 6 will blow up if we add a new prop\n        if (source.hasOwnProperty(prop) && prop in target) {\n          try {\n            target[prop] = source[prop];\n          } catch (e) {// ignore, expected for some properties at some points in the request lifecycle\n          }\n        }\n      });\n      return target;\n    }\n\n    return client(function xhr(request) {\n      return responsePromise.promise(function (resolve, reject) {\n        /*jshint maxcomplexity:20 */\n        var client, method, url, headers, entity, headerName, response, XMLHttpRequest;\n        request = typeof request === 'string' ? {\n          path: request\n        } : request || {};\n        response = {\n          request: request\n        };\n\n        if (request.canceled) {\n          response.error = 'precanceled';\n          reject(response);\n          return;\n        }\n\n        entity = request.entity;\n        request.method = request.method || (entity ? 'POST' : 'GET');\n        method = request.method;\n        url = response.url = new UrlBuilder(request.path || '', request.params).build();\n        XMLHttpRequest = request.engine || global.XMLHttpRequest;\n\n        if (!XMLHttpRequest) {\n          reject({\n            request: request,\n            url: url,\n            error: 'xhr-not-available'\n          });\n          return;\n        }\n\n        try {\n          client = response.raw = new XMLHttpRequest(); // mixin extra request properties before and after opening the request as some properties require being set at different phases of the request\n\n          safeMixin(client, request.mixin);\n          client.open(method, url, true);\n          safeMixin(client, request.mixin);\n          headers = request.headers;\n\n          for (headerName in headers) {\n            /*jshint forin:false */\n            if (headerName === 'Content-Type' && headers[headerName] === 'multipart/form-data') {\n              // XMLHttpRequest generates its own Content-Type header with the\n              // appropriate multipart boundary when sending multipart/form-data.\n              continue;\n            }\n\n            client.setRequestHeader(headerName, headers[headerName]);\n          }\n\n          request.canceled = false;\n\n          request.cancel = function cancel() {\n            request.canceled = true;\n            client.abort();\n            reject(response);\n          };\n\n          client.onreadystatechange = function\n            /* e */\n          () {\n            if (request.canceled) {\n              return;\n            }\n\n            if (client.readyState === (XMLHttpRequest.DONE || 4)) {\n              response.status = {\n                code: client.status,\n                text: client.statusText\n              };\n              response.headers = parseHeaders(client.getAllResponseHeaders());\n              response.entity = client.responseText;\n\n              if (response.status.code > 0) {\n                // check status code as readystatechange fires before error event\n                resolve(response);\n              } else {\n                // give the error callback a chance to fire before resolving\n                // requests for file:// URLs do not have a status code\n                setTimeout(function () {\n                  resolve(response);\n                }, 0);\n              }\n            }\n          };\n\n          try {\n            client.onerror = function\n              /* e */\n            () {\n              response.error = 'loaderror';\n              reject(response);\n            };\n          } catch (e) {// IE 6 will not support error handling\n          }\n\n          client.send(entity);\n        } catch (e) {\n          response.error = 'loaderror';\n          reject(response);\n        }\n      });\n    });\n  });\n})(typeof define === 'function' && define.amd ? define : function (factory) {\n  module.exports = factory(require);\n}, typeof window !== 'undefined' ? window : void 0 // Boilerplate for AMD and Node\n);","map":{"version":3,"names":["define","global","require","when","UrlBuilder","normalizeHeaderName","responsePromise","client","headerSplitRE","parseHeaders","raw","headers","trim","split","forEach","header","boundary","name","value","indexOf","substring","Array","isArray","push","safeMixin","target","source","Object","keys","prop","hasOwnProperty","e","xhr","request","promise","resolve","reject","method","url","entity","headerName","response","XMLHttpRequest","path","canceled","error","params","build","engine","mixin","open","setRequestHeader","cancel","abort","onreadystatechange","readyState","DONE","status","code","text","statusText","getAllResponseHeaders","responseText","setTimeout","onerror","send","amd","factory","module","exports","window"],"sources":["D:/Chronicle/chronicle-ttm/src/main/frontend/node_modules/rest/client/xhr.js"],"sourcesContent":["/*\n * Copyright 2012-2014 the original author or authors\n * @license MIT, see LICENSE.txt for details\n *\n * @author Scott Andrews\n */\n\n(function (define, global) {\n\t'use strict';\n\n\tdefine(function (require) {\n\n\t\tvar when, UrlBuilder, normalizeHeaderName, responsePromise, client, headerSplitRE;\n\n\t\twhen = require('when');\n\t\tUrlBuilder = require('../UrlBuilder');\n\t\tnormalizeHeaderName = require('../util/normalizeHeaderName');\n\t\tresponsePromise = require('../util/responsePromise');\n\t\tclient = require('../client');\n\n\t\t// according to the spec, the line break is '\\r\\n', but doesn't hold true in practice\n\t\theaderSplitRE = /[\\r|\\n]+/;\n\n\t\tfunction parseHeaders(raw) {\n\t\t\t// Note: Set-Cookie will be removed by the browser\n\t\t\tvar headers = {};\n\n\t\t\tif (!raw) { return headers; }\n\n\t\t\traw.trim().split(headerSplitRE).forEach(function (header) {\n\t\t\t\tvar boundary, name, value;\n\t\t\t\tboundary = header.indexOf(':');\n\t\t\t\tname = normalizeHeaderName(header.substring(0, boundary).trim());\n\t\t\t\tvalue = header.substring(boundary + 1).trim();\n\t\t\t\tif (headers[name]) {\n\t\t\t\t\tif (Array.isArray(headers[name])) {\n\t\t\t\t\t\t// add to an existing array\n\t\t\t\t\t\theaders[name].push(value);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t// convert single value to array\n\t\t\t\t\t\theaders[name] = [headers[name], value];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// new, single value\n\t\t\t\t\theaders[name] = value;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn headers;\n\t\t}\n\n\t\tfunction safeMixin(target, source) {\n\t\t\tObject.keys(source || {}).forEach(function (prop) {\n\t\t\t\t// make sure the property already exists as\n\t\t\t\t// IE 6 will blow up if we add a new prop\n\t\t\t\tif (source.hasOwnProperty(prop) && prop in target) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\ttarget[prop] = source[prop];\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e) {\n\t\t\t\t\t\t// ignore, expected for some properties at some points in the request lifecycle\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn target;\n\t\t}\n\n\t\treturn client(function xhr(request) {\n\t\t\treturn responsePromise.promise(function (resolve, reject) {\n\t\t\t\t/*jshint maxcomplexity:20 */\n\n\t\t\t\tvar client, method, url, headers, entity, headerName, response, XMLHttpRequest;\n\n\t\t\t\trequest = typeof request === 'string' ? { path: request } : request || {};\n\t\t\t\tresponse = { request: request };\n\n\t\t\t\tif (request.canceled) {\n\t\t\t\t\tresponse.error = 'precanceled';\n\t\t\t\t\treject(response);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tentity = request.entity;\n\t\t\t\trequest.method = request.method || (entity ? 'POST' : 'GET');\n\t\t\t\tmethod = request.method;\n\t\t\t\turl = response.url = new UrlBuilder(request.path || '', request.params).build();\n\n\t\t\t\tXMLHttpRequest = request.engine || global.XMLHttpRequest;\n\t\t\t\tif (!XMLHttpRequest) {\n\t\t\t\t\treject({ request: request, url: url, error: 'xhr-not-available' });\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tclient = response.raw = new XMLHttpRequest();\n\n\t\t\t\t\t// mixin extra request properties before and after opening the request as some properties require being set at different phases of the request\n\t\t\t\t\tsafeMixin(client, request.mixin);\n\t\t\t\t\tclient.open(method, url, true);\n\t\t\t\t\tsafeMixin(client, request.mixin);\n\n\t\t\t\t\theaders = request.headers;\n\t\t\t\t\tfor (headerName in headers) {\n\t\t\t\t\t\t/*jshint forin:false */\n\t\t\t\t\t\tif (headerName === 'Content-Type' && headers[headerName] === 'multipart/form-data') {\n\t\t\t\t\t\t\t// XMLHttpRequest generates its own Content-Type header with the\n\t\t\t\t\t\t\t// appropriate multipart boundary when sending multipart/form-data.\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tclient.setRequestHeader(headerName, headers[headerName]);\n\t\t\t\t\t}\n\n\t\t\t\t\trequest.canceled = false;\n\t\t\t\t\trequest.cancel = function cancel() {\n\t\t\t\t\t\trequest.canceled = true;\n\t\t\t\t\t\tclient.abort();\n\t\t\t\t\t\treject(response);\n\t\t\t\t\t};\n\n\t\t\t\t\tclient.onreadystatechange = function (/* e */) {\n\t\t\t\t\t\tif (request.canceled) { return; }\n\t\t\t\t\t\tif (client.readyState === (XMLHttpRequest.DONE || 4)) {\n\t\t\t\t\t\t\tresponse.status = {\n\t\t\t\t\t\t\t\tcode: client.status,\n\t\t\t\t\t\t\t\ttext: client.statusText\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tresponse.headers = parseHeaders(client.getAllResponseHeaders());\n\t\t\t\t\t\t\tresponse.entity = client.responseText;\n\n\t\t\t\t\t\t\tif (response.status.code > 0) {\n\t\t\t\t\t\t\t\t// check status code as readystatechange fires before error event\n\t\t\t\t\t\t\t\tresolve(response);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t// give the error callback a chance to fire before resolving\n\t\t\t\t\t\t\t\t// requests for file:// URLs do not have a status code\n\t\t\t\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\t\t\t\tresolve(response);\n\t\t\t\t\t\t\t\t}, 0);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tclient.onerror = function (/* e */) {\n\t\t\t\t\t\t\tresponse.error = 'loaderror';\n\t\t\t\t\t\t\treject(response);\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e) {\n\t\t\t\t\t\t// IE 6 will not support error handling\n\t\t\t\t\t}\n\n\t\t\t\t\tclient.send(entity);\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tresponse.error = 'loaderror';\n\t\t\t\t\treject(response);\n\t\t\t\t}\n\n\t\t\t});\n\t\t});\n\n\t});\n\n}(\n\ttypeof define === 'function' && define.amd ? define : function (factory) { module.exports = factory(require); },\n\ttypeof window !== 'undefined' ? window : void 0\n\t// Boilerplate for AMD and Node\n));\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}